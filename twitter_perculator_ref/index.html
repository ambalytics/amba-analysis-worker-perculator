
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="documentation for amba-analysis-worker-perculator">
      
      
      
        <meta name="author" content="Lukas Jesche">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>twitter perculator - Amba Analysis Worker Perculator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#twitter_perculator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Amba Analysis Worker Perculator" class="md-header__button md-logo" aria-label="Amba Analysis Worker Perculator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amba Analysis Worker Perculator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              twitter perculator
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/ambalytics/amba-analysis-worker-perculator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ambalytics/amba-analysis-worker-perculator
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Amba Analysis Worker Perculator" class="md-nav__button md-logo" aria-label="Amba Analysis Worker Perculator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amba Analysis Worker Perculator
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ambalytics/amba-analysis-worker-perculator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ambalytics/amba-analysis-worker-perculator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Code Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../twitter_supervisor_ref/" class="md-nav__link">
        twitter supervisor
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          twitter perculator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        twitter perculator
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator" class="md-nav__link">
    twitter_perculator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator" class="md-nav__link">
    TwitterPerculator
  </a>
  
    <nav class="md-nav" aria-label="TwitterPerculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.add_publication" class="md-nav__link">
    add_publication()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.get_publication_info" class="md-nav__link">
    get_publication_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.on_message" class="md-nav__link">
    on_message()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.prepare_amba_connection" class="md-nav__link">
    prepare_amba_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.prepare_mongo_connection" class="md-nav__link">
    prepare_mongo_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.save_not_perculated" class="md-nav__link">
    save_not_perculated()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.save_publication_to_mongo" class="md-nav__link">
    save_publication_to_mongo()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.get_publication_from_amba" class="md-nav__link">
    get_publication_from_amba()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.get_publication_from_mongo" class="md-nav__link">
    get_publication_from_mongo()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../doi_resolver_ref/" class="md-nav__link">
        doi resolver
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator" class="md-nav__link">
    twitter_perculator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator" class="md-nav__link">
    TwitterPerculator
  </a>
  
    <nav class="md-nav" aria-label="TwitterPerculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.add_publication" class="md-nav__link">
    add_publication()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.get_publication_info" class="md-nav__link">
    get_publication_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.on_message" class="md-nav__link">
    on_message()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.prepare_amba_connection" class="md-nav__link">
    prepare_amba_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.prepare_mongo_connection" class="md-nav__link">
    prepare_mongo_connection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.save_not_perculated" class="md-nav__link">
    save_not_perculated()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter_perculator.TwitterPerculator.save_publication_to_mongo" class="md-nav__link">
    save_publication_to_mongo()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.get_publication_from_amba" class="md-nav__link">
    get_publication_from_amba()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twitter_perculator.get_publication_from_mongo" class="md-nav__link">
    get_publication_from_mongo()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ambalytics/amba-analysis-worker-perculator/edit/master/docs/twitter_perculator_ref.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>twitter perculator</h1>
                
                <div class="doc doc-object doc-module">

<a id="twitter_perculator"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="twitter_perculator.TwitterPerculator" class="doc doc-heading">
        <code>TwitterPerculator</code>



</h2>

    <div class="doc doc-contents ">

      <p>link events to doi and if possible add a publication to it </p>




  <div class="doc doc-children">




















  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.add_publication" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_publication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">publication</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>add a publication to an event</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code></code></td>
        <td><p>the event we wan't to add a publication to</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>publication</code></td>
        <td><code></code></td>
        <td><p>the publication to add</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_publication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">publication</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add a publication to an event</span>

<span class="sd">    Arguments:</span>
<span class="sd">        event: the event we wan&#39;t to add a publication to</span>
<span class="sd">        publication: the publication to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">+</span> <span class="s2">&quot;linked publication&quot;</span><span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publication</span>
    <span class="n">doi_base_url</span> <span class="o">=</span> <span class="s2">&quot;https://doi.org/&quot;</span>  <span class="c1"># todo</span>
    <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;pid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doi_base_url</span> <span class="o">+</span> <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span>
    <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;alternative-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span>
    <span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;obj_id&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;pid&#39;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.get_publication_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_publication_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doi</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>get publication data for a doi using mongo and amba dbs</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>doi</code></td>
        <td><code></code></td>
        <td><p>the doi for the publication we want</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_publication_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get publication data for a doi using mongo and amba dbs</span>

<span class="sd">    Arguments:</span>
<span class="sd">        doi: the doi for the publication we want</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">publication</span> <span class="o">=</span> <span class="n">get_publication_from_mongo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">doi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">publication</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get publication from mongo&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">publication</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">amba_client</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_amba_connection</span><span class="p">()</span>
    <span class="n">publication</span> <span class="o">=</span> <span class="n">get_publication_from_amba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amba_client</span><span class="p">,</span> <span class="n">doi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">publication</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get publication from amba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_publication_to_mongo</span><span class="p">(</span><span class="n">publication</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">publication</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;doi&#39;</span><span class="p">:</span> <span class="n">doi</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.on_message" class="doc doc-heading">
<code class="highlight language-python"><span class="n">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_msg</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>the on message function to be implemented in own classes</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>json_msg</code></td>
        <td><code></code></td>
        <td><p>the message to do stuff with</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">DAO</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mongo_client</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_mongo_connection</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;either link a event to a publication or add doi to it and mark it unknown to add the publication finder topic</span>

<span class="sd">    Arguments:</span>
<span class="sd">        json_msg: json message representing a event</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
    <span class="n">e</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_msg</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># todo check that source_id is twitter</span>
    <span class="c1"># json_msg = e.data[&#39;subj&#39;][&#39;data&#39;]</span>
    <span class="c1"># logging.warning(self.log + &quot;on message twitter perculator&quot;)</span>

    <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="c1"># we use the id for mongo</span>
        <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="c1"># move matching rules to tweet self</span>
        <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;matching_rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;matching_rules&#39;</span><span class="p">]</span>
        <span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># check for doi recognition on tweet self</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="n">doi_resolver</span><span class="o">.</span><span class="n">url_doi_check</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="c1"># logging.warning(&#39;doi 1 &#39; + str(doi))</span>
        <span class="k">if</span> <span class="n">doi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doi</span>
            <span class="c1"># e.data[&#39;doiTemp&#39;] = doi</span>
            <span class="n">publication</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publication_info</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_publication</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">publication</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">publication</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;linked&#39;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;publish linked message of doi &#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="c1"># check the includes object for the original tweet url</span>
        <span class="k">elif</span> <span class="s1">&#39;tweets&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;includes&#39;</span><span class="p">]:</span>
            <span class="c1"># logging.warning(&#39;tweets&#39;)</span>
            <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;includes&#39;</span><span class="p">][</span><span class="s1">&#39;tweets&#39;</span><span class="p">]:</span>
                <span class="n">doi</span> <span class="o">=</span> <span class="n">doi_resolver</span><span class="o">.</span><span class="n">url_doi_check</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
                <span class="c1"># logging.warning(&#39;doi 2 &#39; + str(doi))</span>
                <span class="k">if</span> <span class="n">doi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># use first doi we get</span>
                    <span class="c1"># logging.warning(self.log + e.data[&#39;subj&#39;][&#39;data&#39;][&#39;_id&#39;] + &quot; doi includes&quot;)</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doi</span>
                    <span class="c1"># e.data[&#39;doiTemp&#39;] = doi</span>
                    <span class="n">publication</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publication_info</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_publication</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">publication</span><span class="p">)</span>

                    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">publication</span><span class="p">:</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;linked&#39;</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;publish linked message of doi in includes&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="c1"># publish_message(producer, parsed_topic_name, &#39;parsed&#39;,</span>
                    <span class="c1">#                 json.dumps(json_msg[&#39;data&#39;], indent=2).encode(&#39;utf-8&#39;))</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; no doi&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_not_perculated</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;subj&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; no doi&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_not_perculated</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.prepare_amba_connection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_amba_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>prepare the amba connection abd setup the client</p>

        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_amba_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;prepare the amba connection abd setup the client</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">AIOHTTPTransport</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amba_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">,</span> <span class="n">fetch_schema_from_transport</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.prepare_mongo_connection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_mongo_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>prepare mongo connection and setup the client</p>

        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_mongo_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;prepare mongo connection and setup the client</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mongo_client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mongo_url&#39;</span><span class="p">],</span>
                                            <span class="n">serverSelectionTimeoutMS</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>  <span class="c1"># 3 second timeout</span>
                                            <span class="n">username</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
                                            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mongo_client</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mongo_client&#39;</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mongo_collection&#39;</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collectionFailed</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span>  <span class="c1"># todo only debug?</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.save_not_perculated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_not_perculated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save thea not peruclated event for debug</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code>Event</code></td>
        <td><p>the event to save</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_not_perculated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; save thea not peruclated event for debug</span>

<span class="sd">    Arguments:</span>
<span class="sd">        event: the event to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;save publication to mongo&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collectionFailed</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;MongoDB, not perculated event &quot;</span> <span class="o">%</span> <span class="n">event</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="twitter_perculator.TwitterPerculator.save_publication_to_mongo" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_publication_to_mongo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">publication</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save the publication to our mongo to
    this allows faster access and to store calculated data right on it
    additional ist easier only to check one db
    use doi as id and key</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>publication</code></td>
        <td><code></code></td>
        <td><p>the publication to save</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_publication_to_mongo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">publication</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; save the publication to our mongo to</span>
<span class="sd">        this allows faster access and to store calculated data right on it</span>
<span class="sd">        additional ist easier only to check one db</span>
<span class="sd">        use doi as id and key</span>

<span class="sd">    Arguments:</span>
<span class="sd">        publication: the publication to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;save publication to mongo&#39;</span><span class="p">)</span>

    <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Amba&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://analysis.ambalytics.cloud/&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;license&#39;</span><span class="p">:</span> <span class="s1">&#39;MIT&#39;</span>
                <span class="p">}]</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">save_publication</span><span class="p">(</span><span class="n">publication</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># publication[&#39;_id&#39;] = publication[&#39;id&#39;]</span>
        <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span>
        <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;amba&#39;</span>
        <span class="n">publication</span><span class="p">[</span><span class="s1">&#39;source-a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;perculator&#39;</span>  <span class="c1"># todo remove</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">publication</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;MongoDB publication, Duplicate found, continue&quot;</span> <span class="o">%</span> <span class="n">publication</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="twitter_perculator.get_publication_from_amba" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_publication_from_amba</span><span class="p">(</span><span class="n">amba_client</span><span class="p">,</span> <span class="n">doi</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>get a publication from amba client using a collection and a doi.
this is cached up to 100</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>amba_client</code></td>
        <td><code></code></td>
        <td><p>the amba_client to use</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>doi</code></td>
        <td><code></code></td>
        <td><p>the doi</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_publication_from_amba</span><span class="p">(</span><span class="n">amba_client</span><span class="p">,</span> <span class="n">doi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get a publication from amba client using a collection and a doi.</span>
<span class="sd">        this is cached up to 100</span>

<span class="sd">        Arguments:</span>
<span class="sd">            amba_client: the amba_client to use</span>
<span class="sd">            doi: the doi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">gql</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        query getPublication($doi: [String!]!) {</span>
<span class="sd">         publicationsByDoi(doi: $doi) {</span>
<span class="sd">          id,</span>
<span class="sd">          type,</span>
<span class="sd">          doi,</span>
<span class="sd">          abstract,</span>
<span class="sd">          pubDate,</span>
<span class="sd">          publisher,</span>
<span class="sd">          rank,</span>
<span class="sd">          citationCount,</span>
<span class="sd">          title,</span>
<span class="sd">          normalizedTitle,</span>
<span class="sd">          year,</span>
<span class="sd">          citations {</span>
<span class="sd">              id,</span>
<span class="sd">              type,</span>
<span class="sd">              doi,</span>
<span class="sd">              abstract,</span>
<span class="sd">              pubDate,</span>
<span class="sd">              publisher,</span>
<span class="sd">              rank,</span>
<span class="sd">              citationCount,</span>
<span class="sd">              title,</span>
<span class="sd">              normalizedTitle,</span>
<span class="sd">              year</span>
<span class="sd">          },</span>
<span class="sd">          refs  {</span>
<span class="sd">              id,</span>
<span class="sd">              type,</span>
<span class="sd">              doi,</span>
<span class="sd">              abstract,</span>
<span class="sd">              pubDate,</span>
<span class="sd">              publisher,</span>
<span class="sd">              rank,</span>
<span class="sd">              citationCount,</span>
<span class="sd">              title,</span>
<span class="sd">              normalizedTitle,</span>
<span class="sd">              year</span>
<span class="sd">          },</span>
<span class="sd">          authors {</span>
<span class="sd">              id,</span>
<span class="sd">              name,</span>
<span class="sd">              normalizedName,</span>
<span class="sd">              pubCount,</span>
<span class="sd">              citationCount,</span>
<span class="sd">              rank</span>
<span class="sd">          },</span>
<span class="sd">          fieldsOfStudy {</span>
<span class="sd">              score,</span>
<span class="sd">              name,</span>
<span class="sd">              normalizedName,</span>
<span class="sd">              level,</span>
<span class="sd">              rank,</span>
<span class="sd">              citationCount</span>
<span class="sd">          }</span>
<span class="sd">        } </span>
<span class="sd">    }</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># todo  affiliation: Affiliation author</span>
    <span class="c1">#   parents: [FieldOfStudy!]</span>
    <span class="c1">#   children: [FieldOfStudy!]</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">amba_client</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">variable_values</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;publicationsByDoi&#39;</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;publicationsByDoi&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">publication</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;publicationsByDoi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">publication</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;unable to get data for doi: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">doi</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="twitter_perculator.get_publication_from_mongo" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_publication_from_mongo</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">doi</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>get a publication from mongo db using a collection and a doi.
this is cached up to 100</p>
<pre><code>!!! arguments
    collection: the collection to use
    doi: the doi
</code></pre>

        <details class="quote">
          <summary>Source code in <code>src/twitter_perculator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_publication_from_mongo</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">doi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get a publication from mongo db using a collection and a doi.</span>
<span class="sd">    this is cached up to 100</span>

<span class="sd">        Arguments:</span>
<span class="sd">            collection: the collection to use</span>
<span class="sd">            doi: the doi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../twitter_supervisor_ref/" class="md-footer__link md-footer__link--prev" aria-label="Previous: twitter supervisor" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              twitter supervisor
            </div>
          </div>
        </a>
      
      
        
        <a href="../doi_resolver_ref/" class="md-footer__link md-footer__link--next" aria-label="Next: doi resolver" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              doi resolver
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>