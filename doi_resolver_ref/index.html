
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="documentation for amba-analysis-worker-perculator">
      
      
      
        <meta name="author" content="Lukas Jesche">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>doi resolver - Amba Analysis Worker Perculator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#doi_resolver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Amba Analysis Worker Perculator" class="md-header__button md-logo" aria-label="Amba Analysis Worker Perculator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amba Analysis Worker Perculator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              doi resolver
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/ambalytics/amba-analysis-worker-perculator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ambalytics/amba-analysis-worker-perculator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Amba Analysis Worker Perculator" class="md-nav__button md-logo" aria-label="Amba Analysis Worker Perculator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amba Analysis Worker Perculator
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ambalytics/amba-analysis-worker-perculator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ambalytics/amba-analysis-worker-perculator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../twitter_perculator_ref/" class="md-nav__link">
        twitter perculator
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          doi resolver
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        doi resolver
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#doi_resolver" class="md-nav__link">
    doi_resolver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.check_doi_list_valid" class="md-nav__link">
    check_doi_list_valid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.crossref_url_search" class="md-nav__link">
    crossref_url_search()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_dois_regex" class="md-nav__link">
    get_dois_regex()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_filtered_dois_from_meta" class="md-nav__link">
    get_filtered_dois_from_meta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_lxml" class="md-nav__link">
    get_lxml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_potential_dois_from_text" class="md-nav__link">
    get_potential_dois_from_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_response" class="md-nav__link">
    get_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.link_url" class="md-nav__link">
    link_url()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.search_fulltext" class="md-nav__link">
    search_fulltext()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.url_doi_check" class="md-nav__link">
    url_doi_check()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#doi_resolver" class="md-nav__link">
    doi_resolver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.check_doi_list_valid" class="md-nav__link">
    check_doi_list_valid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.crossref_url_search" class="md-nav__link">
    crossref_url_search()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_dois_regex" class="md-nav__link">
    get_dois_regex()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_filtered_dois_from_meta" class="md-nav__link">
    get_filtered_dois_from_meta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_lxml" class="md-nav__link">
    get_lxml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_potential_dois_from_text" class="md-nav__link">
    get_potential_dois_from_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.get_response" class="md-nav__link">
    get_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.link_url" class="md-nav__link">
    link_url()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.search_fulltext" class="md-nav__link">
    search_fulltext()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doi_resolver.url_doi_check" class="md-nav__link">
    url_doi_check()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ambalytics/amba-analysis-worker-perculator/edit/master/docs/doi_resolver_ref.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>doi resolver</h1>
                
                <div class="doc doc-object doc-module">

<a id="doi_resolver"></a>
    <div class="doc doc-contents first">

      <p>Helper Class providing multiple static functions to extract a doi from a url </p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.check_doi_list_valid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_doi_list_valid</span><span class="p">(</span><span class="n">potential_dois</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>check if a list of potential dois are valid and if so return the valid doi</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>potential_dois</code></td>
        <td></td>
        <td><p>a list of dois that should be checked</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_doi_list_valid</span><span class="p">(</span><span class="n">potential_dois</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;check if a list of potential dois are valid and if so return the valid doi</span>

<span class="sd">        Arguments:</span>
<span class="sd">            potential_dois: a list of dois that should be checked</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pdoi</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">potential_dois</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">doi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">doi</span><span class="p">:</span>
            <span class="n">pdoi</span> <span class="o">=</span> <span class="n">pdoi</span> <span class="o">+</span> <span class="n">doi</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
    <span class="n">pre</span> <span class="o">=</span> <span class="s2">&quot;http://doi.org/doiRA/&quot;</span>  <span class="c1"># todo</span>
    <span class="n">rw</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">pdoi</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="n">pdoi</span><span class="p">)</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;RA&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">rw</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;DOI&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rw</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.crossref_url_search" class="doc doc-heading">
<code class="highlight language-python"><span class="n">crossref_url_search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>search the url in crossref eventdata to get a doi</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td></td>
        <td><p>the url to get a doi for</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">crossref_url_search</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;search the url in crossref eventdata to get a doi</span>

<span class="sd">        Arguments:</span>
<span class="sd">            url: the url to get a doi for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.eventdata.crossref.org/v1/events?rows=1&amp;obj.url=&quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ok&#39;</span><span class="p">:</span>
                <span class="c1"># logging.debug(json_response)</span>
                <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;events&#39;</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;events&#39;</span><span class="p">]:</span>
                            <span class="k">return</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;obj_id&#39;</span><span class="p">][</span><span class="mi">16</span><span class="p">:]</span>  <span class="c1"># https://doi.org/ -&gt; 16</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.get_dois_regex" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>find all occurrences of a given regex in a doi-string which ending is searched</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>regex</code></td>
        <td></td>
        <td><p>the regex to look for</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>temp_doi</code></td>
        <td></td>
        <td><p>the doi to use</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_dois_regex</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;find all occurrences of a given regex in a doi-string which ending is searched</span>

<span class="sd">        Arguments:</span>
<span class="sd">            regex: the regex to look for</span>
<span class="sd">            temp_doi: the doi to use</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">temp_doi</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># logging.debug(regex.search(temp_doi).group())</span>
        <span class="c1"># logging.debug(regex.findall(temp_doi))</span>
        <span class="k">return</span> <span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">temp_doi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.get_filtered_dois_from_meta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_filtered_dois_from_meta</span><span class="p">(</span><span class="n">potential_dois</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>check potential dois from meta tags for dois to extract them in case they have a full url</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>potential_dois</code></td>
        <td></td>
        <td><p>the dois to filter</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_filtered_dois_from_meta</span><span class="p">(</span><span class="n">potential_dois</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;check potential dois from meta tags for dois to extract them in case they have a full url</span>

<span class="sd">        Arguments:</span>
<span class="sd">            potential_dois: the dois to filter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">potential_dois</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;doi:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="n">doi_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d{4,9}(?:/|</span><span class="si">%2F</span><span class="s2">|</span><span class="si">%2f</span><span class="s2">)[^</span><span class="se">\\</span><span class="s2">s]+)&quot;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">doi_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.get_lxml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_lxml</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>use lxml to search for meta tags that could contain the doi</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>page</code></td>
        <td></td>
        <td><p>the page to search</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_lxml</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;use lxml to search for meta tags that could contain the doi</span>

<span class="sd">        Arguments:</span>
<span class="sd">            page: the page to search</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//meta&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;citation_doi&#39;</span><span class="p">,</span> <span class="s1">&#39;dc.identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;evt-doipage&#39;</span><span class="p">,</span> <span class="s1">&#39;news_doi&#39;</span><span class="p">,</span> <span class="s1">&#39;citation_doi&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;doi&#39;</span><span class="p">,</span> <span class="s1">&#39;DC.DOI&#39;</span><span class="p">,</span> <span class="s1">&#39;DC.Identifier.DOI&#39;</span><span class="p">,</span> <span class="s1">&#39;DOIs&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;bepress_citation_doi&#39;</span><span class="p">,</span> <span class="s1">&#39;rft_id&#39;</span><span class="p">]:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.get_potential_dois_from_text" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_potential_dois_from_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>use multiple different regexes to get a list of potential dois,
it uses a very generic regex first which only checks for the bare minimum start to the end of line,
this result will than be searched for possible endings generating possible dois
the result is a set and will likely contain unvalid dois</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td></td>
        <td><p>the text which should be checked</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_potential_dois_from_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;use multiple different regexes to get a list of potential dois,</span>
<span class="sd">        it uses a very generic regex first which only checks for the bare minimum start to the end of line,</span>
<span class="sd">        this result will than be searched for possible endings generating possible dois</span>
<span class="sd">        the result is a set and will likely contain unvalid dois</span>

<span class="sd">        Arguments:</span>
<span class="sd">            text: the text which should be checked</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doi_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d{4,9}(?:/|</span><span class="si">%2F</span><span class="s2">|</span><span class="si">%2f</span><span class="s2">)[^</span><span class="se">\\</span><span class="s2">s]+)&quot;</span><span class="p">)</span>
    <span class="n">last_slash</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*)/.*$&quot;</span><span class="p">)</span>
    <span class="n">first_slash</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*?)/.*$&quot;</span><span class="p">)</span>
    <span class="n">semicolon</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*);.*$&quot;</span><span class="p">)</span>
    <span class="n">hashchar</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*?)#.*$&quot;</span><span class="p">)</span>
    <span class="n">question_mark</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*?)</span><span class="se">\\</span><span class="s2">?.*$&quot;</span><span class="p">)</span>
    <span class="n">amp_mark</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*?)&amp;.*$&quot;</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(10</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+/.*)v1*$&quot;</span><span class="p">)</span>  <span class="c1"># biorxiv, make if v\\d+ (v and digit v1,v2,v3</span>

    <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">doi_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">temp_doi</span> <span class="o">=</span> <span class="n">doi_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="c1"># logging.debug(doi_re.findall(ur))</span>
        <span class="c1"># logging.debug(temp_doi)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">temp_doi</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">last_slash</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">first_slash</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">semicolon</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">hashchar</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">question_mark</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">amp_mark</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_dois_regex</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">temp_doi</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.get_response" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>get a response from a given url using a given session s, a session can be used for headers,
this function is cached up to 100 elements</p>
<pre><code>!!! arguments
    url: the url to get
    s: the session to use
</code></pre>

        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get a response from a given url using a given session s, a session can be used for headers,</span>
<span class="sd">    this function is cached up to 100 elements</span>

<span class="sd">        Arguments:</span>
<span class="sd">            url: the url to get</span>
<span class="sd">            s: the session to use</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionRefusedError</span><span class="p">,</span> <span class="n">SSLError</span><span class="p">,</span> <span class="n">ReadTimeoutError</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRedirects</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ReadTimeout</span><span class="p">,</span> <span class="n">NewConnectionError</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Perculator error, reset session&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
        <span class="c1"># get the response for the provided url</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Pragma&#39;</span><span class="p">:</span> <span class="s1">&#39;no-cache&#39;</span>
        <span class="p">}</span>
        <span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
            <span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.link_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">link_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>link a url to a valid doi,
it will try to get potential dois using multiple regex and than check if their are valid and than return the doi
it uses multiple methods to search for the doi,
this function is cached up to 10000 elements</p>
<pre><code>!!! arguments
    url: the url to get
    s: the session to use
</code></pre>

        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">link_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;link a url to a valid doi,</span>
<span class="sd">    it will try to get potential dois using multiple regex and than check if their are valid and than return the doi</span>
<span class="sd">    it uses multiple methods to search for the doi,</span>
<span class="sd">    this function is cached up to 10000 elements</span>

<span class="sd">        Arguments:</span>
<span class="sd">            url: the url to get</span>
<span class="sd">            s: the session to use</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># check if the url contains the doi</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="n">check_doi_list_valid</span><span class="p">(</span><span class="n">get_potential_dois_from_text</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">doi</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">doi</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="c1"># get the response for the provided url</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Pragma&#39;</span><span class="p">:</span> <span class="s1">&#39;no-cache&#39;</span>
    <span class="p">}</span>
    <span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="c1"># check if the doi is in any meta tag</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">pot_doi</span> <span class="o">=</span> <span class="n">get_lxml</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="n">check_doi_list_valid</span><span class="p">(</span><span class="n">get_filtered_dois_from_meta</span><span class="p">(</span><span class="n">pot_doi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">doi</span> <span class="ow">and</span> <span class="n">doi</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">([]):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">doi</span>

    <span class="c1"># check if crossref knows this url and returns the doi</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="n">crossref_url_search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">doi</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;crossref&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">doi</span>

    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="c1"># do a fulltext search of the url</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="n">check_doi_list_valid</span><span class="p">(</span><span class="n">search_fulltext</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">doi</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fulltext&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">doi</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.search_fulltext" class="doc doc-heading">
<code class="highlight language-python"><span class="n">search_fulltext</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>search the fulltext of an response</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>r</code></td>
        <td></td>
        <td><p>the response we want to search</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">search_fulltext</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;search the fulltext of an response</span>

<span class="sd">        Arguments:</span>
<span class="sd">            r: the response we want to search</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_potential_dois_from_text</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="doi_resolver.url_doi_check" class="doc doc-heading">
<code class="highlight language-python"><span class="n">url_doi_check</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>check data for urls,
get first url in urls,
prefer expanded_url</p>
<p>!!! arguments
     data: data to get url from</p>

        <details class="quote">
          <summary>Source code in <code>src/doi_resolver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">url_doi_check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;check data for urls,</span>
<span class="sd">       get first url in urls,</span>
<span class="sd">       prefer expanded_url</span>

<span class="sd">        Arguments:</span>
<span class="sd">            data: data to get url from</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doi_data</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;entities&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">][</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">doi_data</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="s1">&#39;expanded_url&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                    <span class="n">doi_data</span> <span class="o">=</span> <span class="n">link_url</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;expanded_url&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">doi_data</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="s1">&#39;unwound_url&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                    <span class="n">doi_data</span> <span class="o">=</span> <span class="n">link_url</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;unwound_url&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">doi_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">doi_data</span>

            <span class="k">if</span> <span class="n">doi_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doi_data</span>
    <span class="k">return</span> <span class="n">doi_data</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../twitter_perculator_ref/" class="md-footer__link md-footer__link--prev" aria-label="Previous: twitter perculator" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              twitter perculator
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>